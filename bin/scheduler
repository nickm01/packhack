#!/usr/bin/env node

var config = require('../config');
var twilio = require('twilio')(config.accountSid, config.authToken);
var MongoClient = require('mongodb').MongoClient;
var mongoOp = require("./model/mongo");
var sendSms = require('./sendsms');
var logging = require('./logging');
var count = 0

function processScheduler() {

  mongoOp.ListItems.find({'listKey':'reminder'}, function(err, listItems){
    if(err){
      logging.logError('scheduler', '', '', err);
    } else {
      listItems.forEach(function(listItem){
      	count++
        sendSms.sendSms("+13476979750", "from scheduler!", function(){
          count--
          if (count == 0) {
	  		  process.exit();   
	  	  }  	
        });
      });
    }
  });
}

processScheduler();

/*
function sendSms(to, message) {
  twilio.messages.create({
    body: message,
    to: to,
    from: config.sendingNumber
  }, function(err, data) {
    if (err) {
      console.error('Could not send message');
      console.error(err);
    } else {
      console.error('SMS');
    }
    process.exit();
  });
};
*/

